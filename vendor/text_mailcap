#!/bin/sh

# https://github.com/wincent/wincent

vim_encoding(){
    if echo "${1}" | grep -q -i iso-8859-1
    then
        echo latin1
        return 0
    fi
    echo "${1}"
}

tmpfile="$1"
encoding="${2}"

# Need to copy the file because mutt will delete it before Vim can read it.
dir=$(mktemp -d)
cp "$tmpfile" "$dir/preview"
tmpfile="$dir/preview"

enc=$(vim_encoding "${encoding}")

urxvt -e $SHELL -c "nvim -R \"+set fileencoding=${enc}\" \
    '+set filetype=mail' '+set nofoldenable' '+set nomodifiable' \
    $tmpfile" >/dev/null 2>&1 &
