#!/bin/sh

# Email signatures in <blockquote> blocks
# Linebreaks preserved in replies
# No signaure: it's in pandoc's template (mail)

print_usage() {
	printf '\n%s\n' "$(basename $0) FILE"
}

if [ ! ${#} -eq 1 ]
then
	print_usage
	exit 1
fi

file="${1}"
whoami > /tmp/whoami

<&0 tee /tmp/original | sed -E -e '/> -- ?$/,/> ?$/ s/>( |( >)+)/&    /' \
    -e '/On .* wrote:$/,$ s/.+/&  /' \
    -e '/^-- $/q' \
    | head -n -1 \
    | pandoc --quiet --template=mail -f markdown_strict+pipe_tables -t html \
        -o "${file}"
