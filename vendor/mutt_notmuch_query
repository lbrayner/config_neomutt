#!/bin/bash

from="$(cat $MUTT_CACHE/mutt_search_template) "
terms=$(rlwrap -H $MUTT_CACHE/notmuch_history -P "$from" \
    sh -c 'read -r -p "notmuch: " reply && echo $reply')

if [[ -z "$terms" ]]
then
    touch $MUTT_CACHE/mutt_search_abort
else
    printf "$terms" > $MUTT_CACHE/mutt_terms
    xargs -0 notmuch search --output=messages < $MUTT_CACHE/mutt_terms \
        > $MUTT_CACHE/mutt_search_results 
    wc -l > $MUTT_CACHE/mutt_search_count < \
        $MUTT_CACHE/mutt_search_results 
    echo '' >> $MUTT_CACHE/mutt_search_results
fi
